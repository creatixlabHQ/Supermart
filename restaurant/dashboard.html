<!DOCTYPE html>
<html>
<head>
  <title>Restaurant Dashboard</title>
  <style>
    body { font-family: Arial; padding:20px; }
    h2 { text-align:center; }
    .card { border:1px solid #ccc; padding:15px; margin:10px; border-radius:8px; }
    .status-pending { background-color:#fff3cd; }
    .status-preparing { background-color:#ffeeba; }
    .status-delivered { background-color:#d4edda; }
    button { margin-top:10px; padding:5px 10px; cursor:pointer; }
    #loader { text-align:center; }
  </style>
</head>
<body>

<h2>Restaurant Dashboard</h2>
<div id="loader">Loading Orders...</div>
<div id="orders"></div>

<script>
const API = "https://script.google.com/macros/s/AKfycbwZ9ijPjvtQ_u0-BU_tNo_3xzlWc8dCP4BamGIS5G4WoG0O2IdHiJCPdvkkS4ddkJIC/exec";
const currentRestaurant = "Supermart"; // For now static, later from login

async function loadOrders(){
  const res = await fetch(API);
  const data = await res.json();

  const filteredOrders = data.filter(order => order.restaurant_id === currentRestaurant);
  const box = document.getElementById("orders");
  box.innerHTML = "";
  document.getElementById("loader").style.display = "none";

  if(filteredOrders.length === 0){
    box.innerHTML = "<p>No orders yet</p>";
    return;
  }

  filteredOrders.reverse().forEach(order=>{
    const card = document.createElement("div");
    card.className = "card status-" + order.status.toLowerCase();

    card.innerHTML = `
      <b>Order ID:</b> ${order.id}<br>
      <b>Customer:</b> ${order.name}<br>
      <b>Address:</b> ${order.address}<br>
      <b>Status:</b> <span id="status-${order.id}">${order.status}</span><br>
      <button onclick="updateStatus('${order.id}', 'Preparing')">Preparing</button>
      <button onclick="updateStatus('${order.id}', 'Delivered')">Delivered</button>
    `;
    box.appendChild(card);
  });
}

async function updateStatus(orderId, newStatus){
  // In future: POST to Apps Script to update Sheet
  document.getElementById("status-"+orderId).innerText = newStatus;
  alert("Status updated to " + newStatus);
}

loadOrders();
setInterval(loadOrders, 5000); // every 5 sec refresh
</script>

</body>
</html>
